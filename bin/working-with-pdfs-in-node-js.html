<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Working With PDFs in Node.js Using pdf-lib | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Working With PDFs in Node.js Using pdf-lib"><meta property="og:url" content="http://www.thecodebarbarian.com/working-with-pdfs-in-node-js"><meta property="og:image" content="https://codebarbarian-images.s3.amazonaws.com/hmb-2017.jpg"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="The pdf-lib npm module makes it easy to create and modify PDFs, including combining two PDFs and adding page numbers. Here's what you need to know."><meta name="twitter:image" content="https://codebarbarian-images.s3.amazonaws.com/hmb-2017.jpg"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Working With PDFs in Node.js Using pdf-lib</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">April 08, 2020</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CVAIKKQM&placement=carbonadsnet" id="_carbonads_js"></script><div class="post-body-text-container"><p>The <a href="https://www.npmjs.com/package/pdf-lib">pdf-lib</a> npm module is a great tool
for creating and editting PDFs with Node.js. <a href="/control-chrome-from-node-js-with-puppeteer.html">Puppeteer</a> is a great tool for <a href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/">generating PDFs from HTML</a>, but unfortunately browser support for <a href="https://www.smashingmagazine.com/2018/05/print-stylesheets-in-2018/">print layouts in CSS</a> is not very good in my experience. The pdf-lib module gives you very fine grained control over PDFs, and
is great for tasks like merging PDFs, adding page numbers and watermarks, splitting PDFs, and basically anything else you might use the <a href="https://www.ilovepdf.com/">ILovePDF API</a> for.</p>
<h2 id="getting-started">Getting Started</h2>
<p>Let&#39;s use pdf-lib to create a simple PDF document. The PDF document will have 1
page with the <a href="https://masteringjs.io/assets/logo.png">Mastering JS logo</a> in the 
middle. </p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { PDFDocument } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pdf-lib'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

run().catch(err =&gt; <span class="hljs-built_in">console</span>.log(err));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Create a new document and add a new page</span>
  <span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> PDFDocument.create();
  <span class="hljs-keyword">const</span> page = doc.addPage();

  <span class="hljs-comment">// Load the image and store it as a Node.js buffer in memory</span>
  <span class="hljs-keyword">let</span> img = fs.readFileSync(<span class="hljs-string">'./logo.png'</span>);
  img = <span class="hljs-keyword">await</span> doc.embedPng(img);

  <span class="hljs-comment">// Draw the image on the center of the page</span>
  <span class="hljs-keyword">const</span> { width, height } = img.scale(<span class="hljs-number">1</span>);
  page.drawImage(img, {
    x: page.getWidth() / <span class="hljs-number">2</span> - width / <span class="hljs-number">2</span>,
    y: page.getHeight() / <span class="hljs-number">2</span> - height / <span class="hljs-number">2</span>
  });

  <span class="hljs-comment">// Write the PDF to a file</span>
  fs.writeFileSync(<span class="hljs-string">'./test.pdf'</span>, <span class="hljs-keyword">await</span> doc.save());
}</code></pre>
<p>Running the above script generates the below PDF. Working with pdf-lib is pretty easy,
there&#39;s just a few gotchas: note that <code>PDFDocument#embedPng()</code> and <code>PDFDocument#save()</code> return promises, so you need to use <a href="https://masteringjs.io/tutorials/fundamentals/async-await"><code>await</code></a>.</p>
<img src="/images/pdf-preview.png" class="inline-image" style="width: 50%">

<h2 id="merging-2-pdfs">Merging 2 PDFs</h2>
<p>The killer feature for pdf-lib is that you can modify existing PDFs, not just
create new ones. For example, suppose you have two PDFs: one containing the cover
of an eBook, and one containing the eBook content. How can you merge the two?
I used the ILovePDF API for <a href="https://asyncawait.net/">my last eBook</a>, but pdf-lib
makes this task easy in Node.js.</p>
<p>Here&#39;s two PDF files: <a href="./images/cover.pdf"><code>cover.pdf</code></a> and <a href="./images/page-30-31.pdf"><code>page-30-31.pdf</code></a>. The below script uses pdf-lib to combine the two into a single
<code>test.pdf</code> file.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { PDFDocument } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pdf-lib'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

run().catch(err =&gt; <span class="hljs-built_in">console</span>.log(err));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Load cover and content pdfs</span>
  <span class="hljs-keyword">const</span> cover = <span class="hljs-keyword">await</span> PDFDocument.load(fs.readFileSync(<span class="hljs-string">'./cover.pdf'</span>));
  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> PDFDocument.load(fs.readFileSync(<span class="hljs-string">'./page-30-31.pdf'</span>));

  <span class="hljs-comment">// Create a new document</span>
  <span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> PDFDocument.create();

  <span class="hljs-comment">// Add the cover to the new doc</span>
  <span class="hljs-keyword">const</span> [coverPage] = <span class="hljs-keyword">await</span> doc.copyPages(cover, [<span class="hljs-number">0</span>]);
  doc.addPage(coverPage);

  <span class="hljs-comment">// Add individual content pages</span>
  <span class="hljs-keyword">const</span> contentPages = <span class="hljs-keyword">await</span> doc.copyPages(content, content.getPageIndices());
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> page <span class="hljs-keyword">of</span> contentPages) {
    doc.addPage(page);
  }

  <span class="hljs-comment">// Write the PDF to a file</span>
  fs.writeFileSync(<span class="hljs-string">'./test.pdf'</span>, <span class="hljs-keyword">await</span> doc.save());
}</code></pre>
<p>Below is what the merged PDF looks like.</p>
<img src="/images/pdf-preview-2.png" class="inline-image">

<h2 id="adding-page-numbers">Adding Page Numbers</h2>
<p>One of the biggest pain points of generating PDFs from HTML with Puppeteer is
<a href="https://github.com/puppeteer/puppeteer/issues/373">how painful it is to add page numbers</a>. Seems simple, but CSS print layouts still don&#39;t quite work for that case.
Take a look at the <a href="https://github.com/vkarpov15/generators-book/blob/62aa664d84526aec226ce135a3ded270f7390a59/compile.js#L83-L90">time I wrote a <code>for</code> loop with hard-coded pixel offsets</a> to get page numbers to show up correctly.</p>
<p>For example, here&#39;s a PDF containing first 4 pages of <em>Mastering Async/Await</em> without 
the page numbers: <a href="./images/content.pdf"><code>./content.pdf</code></a>. Below is a script that
adds page numbers to each page in the PDF.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { PDFDocument, StandardFonts, rgb } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pdf-lib'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

run().catch(err =&gt; <span class="hljs-built_in">console</span>.log(err));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> PDFDocument.load(fs.readFileSync(<span class="hljs-string">'./content.pdf'</span>));

  <span class="hljs-comment">// Add a font to the doc</span>
  <span class="hljs-keyword">const</span> helveticaFont = <span class="hljs-keyword">await</span> content.embedFont(StandardFonts.Helvetica);

  <span class="hljs-comment">// Draw a number at the bottom of each page.</span>
  <span class="hljs-comment">// Note that the bottom of the page is `y = 0`, not the top</span>
  <span class="hljs-keyword">const</span> pages = <span class="hljs-keyword">await</span> content.getPages();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [i, page] <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.entries(pages)) {
    page.drawText(<span class="hljs-string">`<span class="hljs-subst">${+i + 1}</span>`</span>, {
      x: page.getWidth() / <span class="hljs-number">2</span>,
      y: <span class="hljs-number">10</span>,
      size: <span class="hljs-number">15</span>,
      font: helveticaFont,
      color: rgb(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    });
  }

  <span class="hljs-comment">// Write the PDF to a file</span>
  fs.writeFileSync(<span class="hljs-string">'./test.pdf'</span>, <span class="hljs-keyword">await</span> content.save());
}</code></pre>
<p>Below is what the page numbers the script added look like.</p>
<img src="/images/pdf-preview-page-num.png" class="inline-image" style="width: 50%">

<h2 id="moving-on">Moving On</h2>
<p>The Node.js ecosystem is filled with excellent libraries for solving almost any
problem you can think of. The pdf-lib module lets you modify PDFs, <a href="https://www.npmjs.com/package/sharp">sharp</a> lets you handle almost anything with images, <a href="https://www.npmjs.com/package/pkg">pkg</a> bundles Node projects into standalone executables, and so many more. Before you start looking for an online API to solve an issue you&#39;re seeing, try searching npm, you might find a better solution.</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>