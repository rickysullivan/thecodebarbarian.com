<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TE4SWRGR9E"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-TE4SWRGR9E');
</script><title>What's New in Mongoose 4.10: Unique in Arrays | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="What's New in Mongoose 4.10: Unique in Arrays"><meta property="og:url" content="http://www.thecodebarbarian.com/whats-new-in-mongoose-4.10-unique-in-arrays"><meta property="og:image" content="http://i.imgur.com/2Lb4p37.png"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="[Mongoose 4.10.0 just landed](https://github.com/Automattic/mongoose/blob/master/History.md#4100--2017-05-18) and brings with it several powerful features and bug fixes. The most +1-ed feature in this [supporting `unique` in array definitions](https://github.com/Automattic/mongoose/issues/3347) via the [mongoose-unique-array plugin](https://www.npmjs.com/package/mongoose-unique-array). This feature is implemented as a separate plugin because `mongoose-unique-array` does much more than [simply create a unique index](http://mongoosejs.com/docs/validation.html#the-unique-option-is-not-a-validator), it also ties in to validators and versioning. In this article, I'll explain how to use `mongoose-unique-array` and the caveats you need to be aware of when using it."><meta name="twitter:image" content="http://i.imgur.com/2Lb4p37.png"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">What's New in Mongoose 4.10: Unique in Arrays</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">May 16, 2017</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYI5K3Y&placement=thecodebarbariancom" id="_carbonads_js"></script><div class="post-body-text-container"><p><a href="https://github.com/Automattic/mongoose/blob/master/History.md#4100--2017-05-18">Mongoose 4.10.0 just landed</a> and brings with it several powerful features and bug fixes. The most +1-ed feature in this <a href="https://github.com/Automattic/mongoose/issues/3347">supporting <code>unique</code> in array definitions</a> via the <a href="https://www.npmjs.com/package/mongoose-unique-array">mongoose-unique-array plugin</a>. This feature is implemented as a separate plugin because <code>mongoose-unique-array</code> does much more than <a href="http://mongoosejs.com/docs/validation.html#the-unique-option-is-not-a-validator">simply create a unique index</a>, it also ties in to validators and versioning. In this article, I&#39;ll explain how to use <code>mongoose-unique-array</code> and the caveats you need to be aware of when using it.</p>
<h2 id="why-a-separate-plugin">Why a Separate Plugin?</h2>
<p>In mongoose 4.10.0, you can create a model with an array of strings that are supposed to be unique. You don&#39;t need the <code>mongoose-unique-array</code> plugin to create a unique index on an array:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);
mongoose.set(<span class="hljs-string">'debug'</span>, <span class="hljs-literal">true</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> mongoose.connection.dropDatabase();

  <span class="hljs-keyword">const</span> mySchema = <span class="hljs-keyword">new</span> mongoose.Schema({
    names: [{ type: <span class="hljs-built_in">String</span>, unique: <span class="hljs-literal">true</span> }]
  });
  <span class="hljs-keyword">const</span> M = mongoose.model(<span class="hljs-string">'Test'</span>, mySchema);

  <span class="hljs-comment">// Need to wait for indexes to build, otherwise unique won't work!</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    M.once(<span class="hljs-string">'index'</span>, err =&gt; err ? reject(err) : resolve());
  });

  <span class="hljs-comment">// Will throw an error, because multiple documents have 'Test' in</span>
  <span class="hljs-comment">// their `names` array.</span>
  <span class="hljs-keyword">await</span> M.create([{ names: [<span class="hljs-string">'Test'</span>] }, { names: [<span class="hljs-string">'Test'</span>] }]);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>);
}

run().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));</code></pre>
<p>However, <a href="https://docs.mongodb.com/manual/core/index-unique/#unique-constraint-across-separate-documents">MongoDB unique indexes do not prevent saving a document with duplicate values in the <code>names</code> array</a>. MongoDB unique indexes prevent multiple documents from having the value &#39;Test&#39; in their <code>names</code> arrays, but a single document can have duplicate values in <code>names</code>.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);
mongoose.set(<span class="hljs-string">'debug'</span>, <span class="hljs-literal">true</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> mongoose.connection.dropDatabase();

  <span class="hljs-keyword">const</span> mySchema = <span class="hljs-keyword">new</span> mongoose.Schema({
    names: [{ type: <span class="hljs-built_in">String</span>, unique: <span class="hljs-literal">true</span> }]
  });
  <span class="hljs-keyword">const</span> M = mongoose.model(<span class="hljs-string">'Test'</span>, mySchema);

  <span class="hljs-comment">// Need to wait for indexes to build, otherwise unique won't work!</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    M.once(<span class="hljs-string">'index'</span>, err =&gt; err ? reject(err) : resolve());
  });

  <span class="hljs-comment">// Works! Unique indexes do not prevent a single doc from having</span>
  <span class="hljs-comment">// duplicate values</span>
  <span class="hljs-keyword">await</span> M.create([{ names: [<span class="hljs-string">'Test'</span>, <span class="hljs-string">'Test'</span>] }]);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>);
}

run().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));</code></pre>
<p>The <code>mongoose-unique-array</code> plugin adds a <a href="http://mongoosejs.com/docs/validation.html#custom-validators">custom validator</a> to the <code>names</code> array that makes sure the array has no duplicate values.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> uniqueArrayPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose-unique-array'</span>);

mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);
mongoose.set(<span class="hljs-string">'debug'</span>, <span class="hljs-literal">true</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> mongoose.connection.dropDatabase();

  <span class="hljs-keyword">const</span> mySchema = <span class="hljs-keyword">new</span> mongoose.Schema({
    names: [{ type: <span class="hljs-built_in">String</span>, unique: <span class="hljs-literal">true</span> }]
  });
  <span class="hljs-comment">// Add the unique array plugin</span>
  mySchema.plugin(uniqueArrayPlugin);
  <span class="hljs-keyword">const</span> M = mongoose.model(<span class="hljs-string">'Test'</span>, mySchema);

  <span class="hljs-comment">// Need to wait for indexes to build, otherwise unique won't work!</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    M.once(<span class="hljs-string">'index'</span>, err =&gt; err ? reject(err) : resolve());
  });

  <span class="hljs-comment">// Throws a ValidationError. The plugin adds a validator to `names` that will</span>
  <span class="hljs-comment">// fail if there are duplicates.</span>
  <span class="hljs-keyword">await</span> M.create([{ names: [<span class="hljs-string">'Test'</span>, <span class="hljs-string">'Test'</span>] }]);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>);
}

run().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));</code></pre>
<p>This also works for <a href="http://mongoosejs.com/docs/subdocs.html">document arrays</a>:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> mongoose.connection.dropDatabase();

  <span class="hljs-keyword">const</span> mySchema = <span class="hljs-keyword">new</span> mongoose.Schema({
    names: [{ username: { type: <span class="hljs-built_in">String</span>, unique: <span class="hljs-literal">true</span> } }]
  });
  <span class="hljs-comment">// Add the unique array plugin</span>
  mySchema.plugin(uniqueArrayPlugin);
  <span class="hljs-keyword">const</span> M = mongoose.model(<span class="hljs-string">'Test'</span>, mySchema);

  <span class="hljs-comment">// Need to wait for indexes to build, otherwise unique won't work!</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    M.once(<span class="hljs-string">'index'</span>, err =&gt; err ? reject(err) : resolve());
  });

  <span class="hljs-comment">// Throws a ValidationError. The plugin adds a validator to `names`</span>
  <span class="hljs-keyword">await</span> M.create([{ names: [{ username: <span class="hljs-string">'Test'</span> }, { username: <span class="hljs-string">'Test'</span> }] }]);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>);
}

run().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack, error.errors));</code></pre>
<h2 id="concurrency-caveats">Concurrency Caveats</h2>
<p>In the above cases, the entire array is in memory, so checking the array for duplicates is easy: mongoose just loops through the array. However, mongoose converts <code>.push()</code> into a <a href="https://docs.mongodb.com/manual/reference/operator/update/push/"><code>$push</code> operation in MongoDB</a>. In other words, if you use <code>push()</code> instead of overwriting the array each time, mongoose might not actually have the entire array in memory. In this case, the custom validator will not work.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> mongoose.connection.dropDatabase();

  <span class="hljs-keyword">const</span> mySchema = <span class="hljs-keyword">new</span> mongoose.Schema({
    names: [<span class="hljs-built_in">String</span>]
  });
  <span class="hljs-keyword">const</span> M = mongoose.model(<span class="hljs-string">'Test'</span>, mySchema);

  <span class="hljs-keyword">await</span> M.create([{ names: [] }]);
  <span class="hljs-keyword">const</span> [doc1, doc2] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([M.findOne(), M.findOne()]);

  doc1.names.push(<span class="hljs-string">'Test'</span>);
  <span class="hljs-keyword">await</span> doc1.save();
  <span class="hljs-comment">// Will print `[]`, doc2.names is empty even though doc1.names is not</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Before push'</span>, doc2.names);
  doc2.names.push(<span class="hljs-string">'Test'</span>);
  <span class="hljs-keyword">await</span> doc2.save();

  <span class="hljs-comment">// The `names` array has 2 elements, `['Test', 'Test']`</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> M.findById(doc1._id));
}

run().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack, error.errors));</code></pre>
<p>To cope with this edge case, <code>mongoose-unique-array</code> modifies the query mongoose uses to <code>save()</code> the document. It also sets the <code>saveErrorIfNotFound</code> option on your schema so a <code>save()</code> that doesn&#39;t successfully modify a document throws an error.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> mongoose.connection.dropDatabase();

  <span class="hljs-keyword">const</span> mySchema = <span class="hljs-keyword">new</span> mongoose.Schema({
    names: [{ type: <span class="hljs-built_in">String</span>, unique: <span class="hljs-literal">true</span> }]
  });
  <span class="hljs-comment">// Make sure to add the plugin</span>
  mySchema.plugin(uniqueArrayPlugin);
  <span class="hljs-keyword">const</span> M = mongoose.model(<span class="hljs-string">'Test'</span>, mySchema);

  <span class="hljs-comment">// Need to wait for indexes to build, otherwise unique won't work!</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    M.once(<span class="hljs-string">'index'</span>, err =&gt; err ? reject(err) : resolve());
  });

  <span class="hljs-keyword">await</span> M.create([{ names: [] }]);
  <span class="hljs-keyword">const</span> [doc1, doc2] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([M.findOne(), M.findOne()]);

  doc1.names.push(<span class="hljs-string">'Test'</span>);
  <span class="hljs-keyword">await</span> doc1.save();
  <span class="hljs-comment">// Will print `[]`, doc2.names is empty even though doc1.names is not</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Before push'</span>, doc2.names);
  doc2.names.push(<span class="hljs-string">'Test'</span>);
  <span class="hljs-comment">// This will throw an error:</span>
  <span class="hljs-comment">// VersionError: No matching document found for id "591f5f7301c3d066b57abe0a"</span>
  <span class="hljs-keyword">await</span> doc2.save();

  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> M.findById(doc1._id));
}

run().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error));</code></pre>
<p>With debug mode on, you can see the query that mongoose uses to update <code>doc2</code>. Notice that this query only pushes if every element of <code>names</code> is not equal to &#39;Test&#39;. Check out the <a href="https://docs.mongodb.com/manual/reference/operator/query/nin/#nin">docs on MongoDB&#39;s <code>$nin</code> operator</a> for more information.</p>
<pre><code>Mongoose: tests.update({ _id: ObjectId(&quot;591f5f93b6966a66c59355fc&quot;), names: { &#39;$nin&#39;: [ &#39;Test&#39; ] } }, { &#39;$pushAll&#39;: { names: [ &#39;Test&#39; ] }, &#39;$inc&#39;: { __v: 1 } })</code></pre><p>The <code>mongoose-unique-array</code> plugin only affects <code>save()</code>. If you use <a href="http://mongoosejs.com/docs/validation.html#update-validators">update validation</a>, <code>mongoose-unique-array</code> will also help you if you <code>$set</code> an array. However, <code>mongoose-unique-array</code> does <strong>not</strong> help you if you use <code>update()</code> and <code>$push</code>.</p>
<h2 id="moving-on">Moving On</h2>
<p><a href="https://github.com/Automattic/mongoose/blob/master/History.md#4100--2017-05-18">Mongoose 4.10</a> has 8 powerful new features and several small bug fixes, including aliasing and the ability to modify function parameters in pre hooks. Look forward to more articles on these new features, and make sure you upgrade to take advantage of these new features.</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>