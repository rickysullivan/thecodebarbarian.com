<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>GitHub OAuth Login with Node.js | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="GitHub OAuth Login with Node.js"><meta property="og:url" content="http://www.thecodebarbarian.com/github-oauth-login-with-node-js"><meta property="og:image" content="https://codebarbarian-images.s3.amazonaws.com/montenegro-island.jpg"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="GitHub OAuth lets you build apps that take action on behalf of users. Here's how you can build your own basic GitHub OAuth app with GitHub login."><meta name="twitter:image" content="https://codebarbarian-images.s3.amazonaws.com/montenegro-island.jpg"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">GitHub OAuth Login with Node.js</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">March 31, 2020</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYI5K3Y&placement=thecodebarbariancom" id="_carbonads_js"></script><div class="post-body-text-container"><p><a href="https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/">GitHub OAuth Apps</a> let users log in to your app using their GitHub
account. You can also take actions on behalf of users using the GitHub API,
like posting comments or closing pull requests. In this article, I&#39;ll explain
how to support GitHub login using Node.js and <a href="http://expressjs.com/">Express</a>,
and how to use the GitHub API once you&#39;ve got an access token for the user.</p>
<h2 id="supporting-github-login">Supporting GitHub Login</h2>
<p>Most tutorials use <a href="https://www.npmjs.com/package/passport">Passport</a>, but Passport
is usually unnecessary. This tutorial will use vanilla Express, with no dedicated
OAuth frameworks.</p>
<p>The web OAuth 2.0 login flow has 3 steps:</p>
<ol>
<li>Your app client redirects to GitHub with your app&#39;s id and a URL to redirect the user to when they successfully authorize your app.</li>
<li>The dialog redirects back to your app client&#39;s domain with an auth code in the query string. An auth code is a short-lived code that you can exchange for a long-lived access token.</li>
<li>Your app pulls the code parameter from the query string, and makes a POST request to the GitHub with the access code. GitHub verifies the access code and sends back an access token your app can use for authorization going forward. Your app is responsible for storing the access token.</li>
</ol>
<p>When implementing <a href="/passport-free-facebook-login-with-node-js.html">Passport-free OAuth login</a>, you need 3 routes:</p>
<ol>
<li>A route that displays a UI which can redirect to GitHub to log in.</li>
<li>A route that exchanges an auth code for an access token and stores the access token.</li>
<li>A route that does something with the access token.</li>
</ol>
<p>First, you need to create a GitHub OAuth App. Go to <a href="https://github.com/settings/developers">your Developer Settings page</a> and click &quot;New OAuth App.&quot; Make sure you create a new OAuth App, <strong>not</strong> a new GitHub App.</p>
<img src="/images/github-oauth.png" class="inline-image">

<p>Create a new GitHub OAuth App with <code>http://localhost:3000/oauth-callback</code> as the
OAuth redirect URL. Once you&#39;ve created a GitHub OAuth App, note the Client Id and Client Secret:</p>
<img src="/images/oauth-app.png" class="inline-image">

<p>Now that you have a Client Id and Client Secret, you can build a minimal Express
API that redirects to GitHub to authorize your app:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);

<span class="hljs-keyword">const</span> app = express();

<span class="hljs-keyword">const</span> clientId = <span class="hljs-string">'OMITTED'</span>;
<span class="hljs-keyword">const</span> clientSecret = <span class="hljs-string">'OMITTED'</span>;

app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.redirect(<span class="hljs-string">`https://github.com/login/oauth/authorize?client_id=<span class="hljs-subst">${clientId}</span>`</span>);
});

app.listen(<span class="hljs-number">3000</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'App listening on port 3000'</span>);</code></pre>
<p>Run this app, go to <code>http://localhost:3000</code>, and you&#39;ll see a GitHub login screen.</p>
<img src="/images/github-login.png" class="inline-image" style="width: 50%">

<p>When you log in, GitHub will redirect to your redirect URL, which should be
<code>http://localhost:3000/oauth-callback</code>, with a <code>code</code> parameter in the query
string. Your Express server needs to then make an HTTP POST request to <code>https://github.com/login/oauth/access_token</code> to exchange this access code for an access
token. Your app should <a href="/passport-free-facebook-login-with-node-js.html#storing-access-tokens-in-mongoose">store this access token in a database like MongoDB</a>.
But, for the sake of a simple example, let&#39;s keep the access token in memory.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
<span class="hljs-keyword">let</span> token = <span class="hljs-literal">null</span>;

app.get(<span class="hljs-string">'/oauth-callback'</span>, (req, res) =&gt; {
  <span class="hljs-keyword">const</span> body = {
    client_id: clientId,
    client_secret: clientSecret,
    code: req.query.code
  };
  <span class="hljs-keyword">const</span> opts = { headers: { accept: <span class="hljs-string">'application/json'</span> } };
  axios.post(<span class="hljs-string">`https://github.com/login/oauth/access_token`</span>, body, opts).
    then(res =&gt; res.data[<span class="hljs-string">'access_token'</span>]).
    then(_token =&gt; {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'My token:'</span>, token);
      token = _token;
      res.json({ ok: <span class="hljs-number">1</span> });
    }).
    <span class="hljs-keyword">catch</span>(err =&gt; res.status(<span class="hljs-number">500</span>).json({ message: err.message }));
});</code></pre>
<p>Now, you can go all the way through the GitHub OAuth flow and get a GitHub token.
That&#39;s how you can handle logging in with GitHub, next let&#39;s use the token to
make some basic API requests.</p>
<h2 id="making-a-request-to-the-github-api">Making a Request to the GitHub API</h2>
<p><a href="https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/">GitHub OAuth App scopes</a> determine what permissions your OAuth App has. By default, your OAuth App just gets access to some basic public information about the user. But you can add <a href="https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#requested-scopes-and-granted-scopes">scopes</a> that allow your OAuth app to take actions on behalf of your user.</p>
<p>To edit comments, you need the <a href="https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes"><code>repo</code> scope</a>. To get the repo scope, you need to add it to the URL that you redirect users to.</p>
<pre><code class="language-javascript">app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.redirect(<span class="hljs-string">`https://github.com/login/oauth/authorize?client_id=<span class="hljs-subst">${clientId}</span>&amp;scope=repo`</span>);
});</code></pre>
<p>Make sure you re-authenticate and get a new access token. Once you have an access
token, you can use the GitHub comments API to list all comments on a repo.
For example, here&#39;s how you can use Axios to get all the comments on <a href="https://github.com/vkarpov15/thecodebarbarian.com">this blog&#39;s GitHub repo</a>. Since this repo is
public, no token required.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">await</span> axios.get(<span class="hljs-string">'https://api.github.com/repos/vkarpov15/thecodebarbarian.com/issues/comments'</span>).
  then(res =&gt; res.data);</code></pre>
<p>Below is the output:</p>
<pre><code>[ { url:
     &#39;https://api.github.com/repos/vkarpov15/thecodebarbarian.com/issues/comments/70603151&#39;,
    html_url:
     &#39;https://github.com/vkarpov15/thecodebarbarian.com/pull/1#issuecomment-70603151&#39;,
    issue_url:
     &#39;https://api.github.com/repos/vkarpov15/thecodebarbarian.com/issues/1&#39;,
    id: 70603151,
    node_id: &#39;MDEyOklzc3VlQ29tbWVudDcwNjAzMTUx&#39;,
    user:
     { login: &#39;vkarpov15&#39;,
       id: 1620265,
       node_id: &#39;MDQ6VXNlcjE2MjAyNjU=&#39;,
       avatar_url: &#39;https://avatars2.githubusercontent.com/u/1620265?v=4&#39;,
       gravatar_id: &#39;&#39;,
       url: &#39;https://api.github.com/users/vkarpov15&#39;,
       html_url: &#39;https://github.com/vkarpov15&#39;,
       followers_url: &#39;https://api.github.com/users/vkarpov15/followers&#39;,
       following_url:
        &#39;https://api.github.com/users/vkarpov15/following{/other_user}&#39;,
       gists_url: &#39;https://api.github.com/users/vkarpov15/gists{/gist_id}&#39;,
       starred_url:
        &#39;https://api.github.com/users/vkarpov15/starred{/owner}{/repo}&#39;,
       subscriptions_url: &#39;https://api.github.com/users/vkarpov15/subscriptions&#39;,
       organizations_url: &#39;https://api.github.com/users/vkarpov15/orgs&#39;,
       repos_url: &#39;https://api.github.com/users/vkarpov15/repos&#39;,
       events_url: &#39;https://api.github.com/users/vkarpov15/events{/privacy}&#39;,
       received_events_url: &#39;https://api.github.com/users/vkarpov15/received_events&#39;,
       type: &#39;User&#39;,
       site_admin: false },
    created_at: &#39;2015-01-20T04:31:18Z&#39;,
    updated_at: &#39;2015-01-20T04:31:18Z&#39;,
    author_association: &#39;OWNER&#39;,
    body: &#39;Thanks!\n&#39; },
  ...</code></pre><p>While you don&#39;t need a token to read the comments, you do need one to edit a comment. Each comment has an <code>id</code> property, for example, <code>70603151</code>. To edit a comment, you need to make an HTTP PATCH request to <code>/repos/vkarpov15/thecodebarbarian.com/issues/comments/:comment_id</code>, with <code>token: ${accessToken}</code> as the authorization header.</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Replace 'Thanks' with 'Thank You' in the comment text.</span>
axios.patch(<span class="hljs-string">`https://api.github.com/repos/vkarpov15/thecodebarbarian.com/issues/comments/<span class="hljs-subst">${id}</span>`</span>, {
  body: comment.body.replace(<span class="hljs-string">'Thanks'</span>, <span class="hljs-string">'Thank You'</span>)
}, { headers: { authorization: <span class="hljs-string">`token <span class="hljs-subst">${token}</span>`</span> } });</code></pre>
<h2 id="github-apps-vs-oauth-apps">GitHub Apps vs OAuth Apps</h2>
<p><a href="/building-a-github-app-with-node-js.html">GitHub Apps</a> are actually a completely
different concept from GitHub OAuth Apps. There are 2 major differences:</p>
<p>1) An OAuth app takes action on behalf of a user, whereas a GitHub App is a distinct user. For example, if you log in to a GitHub OAuth app and the OAuth app posts a comment on an issue, that comment will be associated with your GitHub username. On the other hand, if a GitHub App posts on an issue, that comment will be associated with the GitHub App rather than any individual user.</p>
<p>2) OAuth Apps are scoped to an individual user and have the same permissions as that user. GitHub Apps are scoped to an organization or a subset of an organization. This has important implications for installing your app: if you aren&#39;t an admin on an organization, you need to request permission to install a GitHub App that interacts with that repo. For example, since the <a href="https://github.com/Automattic/mongoose">Mongoose GitHub repo is under Automattic&#39;s organization</a>, I can&#39;t install a GitHub App on the Mongoose repo without Automattic&#39;s help. But I can install an OAuth App that pushes to the repo, because OAuth Apps have a subset of my permissions as a GitHub user.</p>
<h2 id="moving-on">Moving On</h2>
<p>Once you wrap your head around the authentication quirks, the GitHub API is pleasant
to work with and has a lot of useful features. With OAuth Apps, you can automate
repetitive tasks, like checking comment code examples, fixing spelling mistakes,
and closing stale issues. OAuth Apps also have a simpler permission model than
GitHub Apps - your OAuth App has the same permissions you do as the authorizing user.
Try building your own GitHub OAuth App next time you find yourself dreading
scrolling through a bunch of issues. </p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>