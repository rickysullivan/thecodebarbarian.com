<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TE4SWRGR9E"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-TE4SWRGR9E');
</script><title>Introducing Private Preview for Stargate-Mongoose Astra Support | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Introducing Private Preview for Stargate-Mongoose Astra Support"><meta property="og:url" content="http://www.thecodebarbarian.com/introducing-private-preview-for-stargate-mongoose-astra"><meta property="og:image" content="https://images.unsplash.com/photo-1515705576963-95cad62945b6?ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&amp;auto=format&amp;fit=crop&amp;w=710&amp;q=80"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="Learn how you can sign up to beta test Mongoose with Astra, DataStax's cloud DBaaS for Cassandra, with stargate-mongoose, eliminating the need to run Stargate locally."><meta name="twitter:image" content="https://images.unsplash.com/photo-1515705576963-95cad62945b6?ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&amp;auto=format&amp;fit=crop&amp;w=710&amp;q=80"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Introducing Private Preview for Stargate-Mongoose Astra Support</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">May 25, 2023</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYI5K3Y&placement=thecodebarbariancom" id="_carbonads_js"></script><div class="post-body-text-container"><p>Earlier in 2023 we announced that we&#39;re working on <a href="/were-working-on-cassandra-support-for-mongoose.html">Mongoose support for Apache Cassandra via DataStax&#39;s new JSON API</a>.
The big caveat with that announcement was that <a href="https://npmjs.com/package/stargate-mongoose">stargate-mongoose</a> only supported running the <a href="https://github.com/stargate/jsonapi">Stargate JSON API</a> locally.
We&#39;ve been hard at work on adding support for <a href="https://astra.datastax.com/">Astra</a>, DataStax&#39;s cloud DBaaS for Cassandra, to stargate-mongoose.
This is a huge step forward for making stargate-mongoose production ready, because now you don&#39;t have to run Stargate yourself in order to use Mongoose with Cassandra.</p>
<p>Astra support is coming along nicely, and we&#39;re now ready to accept beta testers.
If you&#39;re interested in trying out Mongoose and JSON API on Astra, please send an email to <a href="mailto:json-preview@datastax.com">json-preview@datastax.com</a>. Please keep in mind that initially this will be available in only one region, and there is no SLA associated with your data. As we move out of Early Access and into General Availability, all Astra regions will be available, all Astra general SLAs will be applicable, and any specifics relative the stargate-mongoose and the JSON API will be communicated.</p>
<h2 id="connecting-mongoose-to-astra">Connecting Mongoose to Astra</h2>
<p>Keep in mind that, right now, JSON API support in Astra is in a private preview.
In order to get access, you need to <a href="https://deploy-preview-1--amazing-cassata-75f094.netlify.app/">create an Astra account</a> submit a request here.
That being said, once you have access, log in to Astra and create a new database.</p>
<p><img src="https://user-images.githubusercontent.com/1620265/236689443-3a13c6fb-fe19-4f74-abc3-e9db6e6bd04f.png" alt="image"></p>
<p>Once you have created a new database, create a new application token and gather the required credentials:</p>
<ol>
<li><code>ASTRA_DB_ID</code></li>
<li><code>ASTRA_DB_REGION</code></li>
<li><code>ASTRA_DB_KEYSPACE</code></li>
<li><code>ASTRA_DB_APPLICATION_TOKEN</code></li>
</ol>
<p>The &quot;Configure your environment&quot; section has all the required fields except the application token.</p>
<p><img src="https://user-images.githubusercontent.com/1620265/236690836-e98f5053-90fc-4f7c-8c25-8354b61620f7.png" alt="image"></p>
<p>Combine these credentials into a connection string as follows:</p>
<pre><code>https://${ASTRA_DB_ID}-${ASTRA_DB_REGION}.apps.astra.datastax.com/api/json/v1/${ASTRA_DB_KEYSPACE}?applicationToken=${ASTRA_DB_APPLICATION_TOKEN}</code></pre><p>Or, you can use the below tool to generate the connection string.</p>
<style>
  .connection-string-tool label {
    width: 280px;
    margin-right: 1em;
  }
  .connection-string-tool input[type="text"] {
    width: 500px;
  }
</style>
<div class="connection-string-tool">
  <div>
    <label>ASTRA_DB_ID</label>
    <input id="astra_db_id" type="text" placeholder="2597da05-9018-4566-a534-04338b75973b">
  </div>
  <div>
    <label>ASTRA_DB_REGION</label>
    <input id="astra_db_region" type="text" placeholder="eu-west-1">
  </div>
  <div>
    <label>ASTRA_DB_KEYSPACE</label>
    <input id="astra_db_keyspace" type="text" placeholder="mongoose">
  </div>
  <div>
    <label>ASTRA_DB_APPLICATION_TOKEN</label>
    <input id="astra_db_application_token" type="text" placeholder="AstraCS:mytoken">
  </div>
  <div>
    <label>OUTPUT</label>
    <input id="output" type="text" readonly="true">
  </div>
</div>
<script>
  let astraDbId = '2597da05-9018-4566-a534-04338b75973b';
  let astraDbRegion = 'eu-west-1';
  let astraDbKeyspace = 'mongoose';
  let astraDbApplicationToken = 'AstraCS:mytoken';
  let output = `https://${astraDbId}-${astraDbRegion}.apps.astra.datastax.com/api/json/v1/${astraDbKeyspace}?applicationToken=${astraDbApplicationToken}`;
  document.querySelector('#astra_db_id').addEventListener('keyup', function(ev) {
    astraDbId = ev.target.value || '2597da05-9018-4566-a534-04338b75973b';
    output = `https://${astraDbId}-${astraDbRegion}.apps.astra.datastax.com/api/json/v1/${astraDbKeyspace}?applicationToken=${astraDbApplicationToken}`;
    document.querySelector('#output').value = output;
  });
  document.querySelector('#astra_db_region').addEventListener('keyup', function(ev) {
    astraDbRegion = ev.target.value || 'eu-west-1';
    output = `https://${astraDbId}-${astraDbRegion}.apps.astra.datastax.com/api/json/v1/${astraDbKeyspace}?applicationToken=${astraDbApplicationToken}`;
    document.querySelector('#output').value = output;
  });
  document.querySelector('#astra_db_keyspace').addEventListener('keyup', function(ev) {
    astraDbKeyspace = ev.target.value || 'mongoose';
    output = `https://${astraDbId}-${astraDbRegion}.apps.astra.datastax.com/api/json/v1/${astraDbKeyspace}?applicationToken=${astraDbApplicationToken}`;
    document.querySelector('#output').value = output;
  });
  document.querySelector('#astra_db_application_token').addEventListener('keyup', function(ev) {
    astraDbApplicationToken = ev.target.value || 'AstraCS:mytoken';
    output = `https://${astraDbId}-${astraDbRegion}.apps.astra.datastax.com/api/json/v1/${astraDbKeyspace}?applicationToken=${astraDbApplicationToken}`;
    document.querySelector('#output').value = output;
  });
  document.querySelector('#output').addEventListener('click', ev => {
    ev.target.select();
    ev.target.setSelectionRange(0, 99999);
    document.execCommand('copy');
  });
  document.querySelector('#output').value = output;
</script>

<p>Once you&#39;ve created the connection string, you can connect to Astra with Mongoose by passing the connection string to <code>mongoose.connect()</code> as follows.
The <code>isAstra</code> and <code>createNamespaceOnConnect</code> options are required.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> { driver } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stargate-mongoose'</span>);

mongoose.setDriver(driver);

mongoose.connect(astraConnectionString, {
  isAstra: <span class="hljs-literal">true</span>,
  createNamespaceOnConnect: <span class="hljs-literal">false</span>
});</code></pre>
<p>Or you can try out one of our <a href="https://github.com/stargate/stargate-mongoose-sample-apps">sample apps</a>.
Just follow the instructions for connecting to Astra in the sample app&#39;s <code>README</code>, like the instructions in the <a href="https://github.com/stargate/stargate-mongoose-sample-apps/blob/main/netlify-functions-ecommerce/README.md">Netlify ecommerce sample app</a>.</p>
<h2 id="introducing-create-stargate-mongoose-app">Introducing create-stargate-mongoose-app</h2>
<p>In order to help you get started with Mongoose and Astra, we&#39;ve built <a href="https://www.npmjs.com/package/create-stargate-mongoose-app">create-stargate-mongoose-app</a>.
This tool lets you create a new stargate-mongoose project based on one of our <a href="https://github.com/stargate/stargate-mongoose-sample-apps">sample apps</a>:</p>
<ol>
<li>netlify-functions-ecommerce: an ecommerce store that runs on <a href="https://www.netlify.com/">Netlify</a> and uses Stripe for payments</li>
<li>discord-bot: a basic discord bot that makes queries and inserts documents based on discord commands</li>
<li>typescript-express-reviews: a TypeScript and <a href="https://expressjs.com/">Express</a> app that stores reviews for vehicles</li>
</ol>
<p>For example, to create a <code>my-discord-bot</code> directory based on the discord-bot project, you can run the following command:</p>
<pre><code>npx create-stargate-mongoose-app my-discord-bot --sample discord-bot</code></pre><p>create-stargate-mongoose-app will copy the latest version of the discord bot sample app into the <code>my-discord-bot</code> directory and run <code>npm install</code> for you, so you&#39;ll have an Astra-backed discord bot ready to go.</p>
<h2 id="moving-on">Moving On</h2>
<p>Adding Astra support is a major step forward for stargate-mongoose, because now you can get a Cassandra-backed Mongoose app running with just a few clicks in a UI.
This means that users no longer have to run Stargate themselves to use Mongoose with Cassandra.
And as a Mongoose developer, this means you&#39;ll be able to leverage Cassandra&#39;s scalability and durability, particularly in write-heavy applications.
Want to try it out?
Astra support is currently in private preview, but you can request access by emailing <a href="mailto:json-preview@datastax.com">json-preview@datastax.com</a>.</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>