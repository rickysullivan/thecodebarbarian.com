<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Testing Client-side JavaScript with Karma | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Testing Client-side JavaScript with Karma"><meta property="og:url" content="http://www.thecodebarbarian.com/2015/05/08/testing-client-side-javascript-with-karma"><meta property="og:image" content="http://i.imgur.com/NDZxX2t.png"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="*This post originally appeared on [strongloop.com](https://strongloop.com/strongblog/karma-test-client-side-javascript/). StrongLoop provides tools and services for companies developing APIs in Node. [Learn more...](http://www.strongloop.com)*"><meta name="twitter:image" content="http://i.imgur.com/NDZxX2t.png"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Testing Client-side JavaScript with Karma</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">May 08, 2015</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYI5K3Y&placement=thecodebarbariancom" id="_carbonads_js"></script><div class="post-body-text-container"><p><em>This post originally appeared on <a href="https://strongloop.com/strongblog/karma-test-client-side-javascript/">strongloop.com</a>. StrongLoop provides tools and services for companies developing APIs in Node. <a href="http://www.strongloop.com">Learn more...</a></em></p>
<p>I have often quipped that if I were stuck on a desert island with
only one npm module, I&#39;d choose
<a href="https://www.npmjs.com/package/karma">karma</a>.
The one place where you can&#39;t avoid using JavaScript is in the
browser. Even
<a href="http://en.wikipedia.org/wiki/Dart_%28programming_language%29">Dart</a>
needs to be transpiled to JavaScript to work on browsers other than
<a href="https://www.dartlang.org/tools/dartium/">Dartium</a>. And code that
can&#39;t be tested should not be written. Karma is a widely-adopted
command-line tool for testing JavaScript code in real browsers.
It has <a href="https://www.npmjs.com/search?q=karma">myriad plugins</a> that
enable you to write tests using virtually any framework (mocha, 
jasmine, ngScenario, etc.) and run them against a local browser
or in <a href="https://saucelabs.com/">Sauce&#39;s Selenium cloud</a>.</p>
<p>In this article, you&#39;ll see how to use karma to test standalone
JavaScript locally, to test DOM interactions locally, and to run
tests on Sauce Labs. The code for all these examples is available
on
<a href="https://github.com/vkarpov15/karma-demo">my karma-demo GitHub repo</a>.</p>
<h2 id="your-first-karma-test">Your First Karma Test</h2>
<p>Like <a href="https://www.npmjs.com/package/gulp">gulp</a> or
<a href="https://www.npmjs.com/package/metalsmith">metalsmith</a>, karma is
organized as a lightweight core surrounded by a loose confederation
of plugins. Although you will interact with the karma core
executable, you will typically need to install numerous plugins to
do anything useful.</p>
<p>Suppose you have a trivial browser-side JavaScript file like below.
This code is
<a href="https://github.com/vkarpov15/karma-demo/blob/master/lib/sample.js"><code>lib/sample.js</code> in the karma-demo GitHub repo</a></p>
<pre><code class="language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">theAnswer</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
}</code></pre>
<p>Testing this in NodeJS would be fairly simple. But, what if you
wanted to test this in a real browser, like Chrome?
Let&#39;s say you have the
<a href="https://github.com/vkarpov15/karma-demo/blob/master/test/sample.test.js">following test file</a>.</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'sample'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  it(<span class="hljs-string">'returns 42'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    assert.equal(theAnswer(), <span class="hljs-number">42</span>);
  });
});</code></pre>
<p>To run this test in Chrome, set up your <code>package.json</code> with
karma and 3 plugins. As you might expect, <code>karma-mocha</code> is
a karma plugin that enables you to use the
<a href="https://www.npmjs.com/package/mocha">mocha test framework</a>, and
<code>karma-chrome-launcher</code> enables karma to launch Chrome locally.
The <code>karma-chai</code> package is a wrapper around the
<a href="https://www.npmjs.com/package/chai"><code>chai</code> assertion framework</a>,
since neither mocha nor karma includes an assertion framework by
default.</p>
<pre><code class="language-javascript">{
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"karma"</span>: <span class="hljs-string">"0.12.31"</span>,
    <span class="hljs-string">"karma-chai"</span>: <span class="hljs-string">"0.1.0"</span>,
    <span class="hljs-string">"karma-chrome-launcher"</span>: <span class="hljs-string">"0.1.4"</span>,
    <span class="hljs-string">"karma-mocha"</span>: <span class="hljs-string">"0.1.10"</span>
  }
}</code></pre>
<p>Now that you have karma installed, you need a karma config file.
You can run <code>./node_modules/karma/bin/karma init</code> to have karma
initialize one for you, but the
<a href="https://github.com/vkarpov15/karma-demo/blob/master/test/karma.mocha.conf.js">karma config file you&#39;re going to need</a>
is shown below.</p>
<pre><code class="language-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
  config.set({
    <span class="hljs-comment">// Use cwd as base path</span>
    basePath: <span class="hljs-string">''</span>,

    <span class="hljs-comment">// Include mocha test framework and chai assertions</span>
    frameworks: [<span class="hljs-string">'mocha'</span>, <span class="hljs-string">'chai'</span>],

    <span class="hljs-comment">// Include the test and source files</span>
    files: [<span class="hljs-string">'../lib/*.js'</span>, <span class="hljs-string">'./sample.test.js'</span>],

    <span class="hljs-comment">// Use built-in 'progress' reporter</span>
    reporters: [<span class="hljs-string">'progress'</span>],

    <span class="hljs-comment">// Boilerplate</span>
    urlRoot : <span class="hljs-string">'/__karma__/'</span>,
    port: <span class="hljs-number">8080</span>,
    runnerPort: <span class="hljs-number">9100</span>,
    colors: <span class="hljs-literal">true</span>,
    logLevel: config.LOG_INFO,

    <span class="hljs-comment">/* Karma can watch the file system for changes and
     * automatically re-run tests. Making karma do it
     * is more efficient than using gulp because karma
     * can re-use the same browser process. Set this to
     * true and `singleRun` to false to run tests
     * continuously */</span>
    autoWatch: <span class="hljs-literal">false</span>,

    <span class="hljs-comment">// Set the browser to run</span>
    browsers: [<span class="hljs-string">'Chrome'</span>],

    <span class="hljs-comment">// See autoWatch</span>
    singleRun: <span class="hljs-literal">true</span>,

    <span class="hljs-comment">// Consider browser as dead if no response for 5 sec</span>
    browserNoActivityTimeout: <span class="hljs-number">5000</span>
  });
};</code></pre>
<p>One key feature of the above config file is that karma configs are
NodeJS JavaScript, not just JSON or YAML. You can do file I/O,
access environment variables, and <code>require()</code> npm modules in your
karma configs.</p>
<p>Once you have this config file, you can run karma using the
<code>./node_modules/karma/bin/karma start test/karma.mocha.conf.js</code> 
command. You should see a Chrome browser pop up and output similar 
to what you see below in the shell:</p>
<pre><code>$ ./node_modules/karma/bin/karma start ./test/karma.mocha.conf.js 
WARN [karma]: Port 8080 in use
INFO [karma]: Karma v0.12.31 server started at http://localhost:8081/__karma__/
INFO [launcher]: Starting browser Chrome
INFO [Chrome 42.0.2311 (Mac OS X 10.10.3)]: Connected on socket NE7VtfIGgPAVbIB8nBIA with id 416059
Chrome 42.0.2311 (Mac OS X 10.10.3): Executed 1 of 1 SUCCESS (0 secs / 0.001 secChrome 42.0.2311 (Mac OS X 10.10.3): Executed 1 of 1 SUCCESS (0.012 secs / 0.001 secs)</code></pre><h2 id="testing-dom-interactions-with-ngscenario">Testing DOM Interactions with ngScenario</h2>
<p>Karma isn&#39;t just useful for testing isolated JavaScript. With
<a href="https://code.angularjs.org/1.2.16/docs/guide/e2e-testing">ngScenario</a>
and the
<a href="https://www.npmjs.com/package/karma-ng-scenario">karma-ng-scenario plugin</a>
you can test DOM interactions against your local server in a
real browser. In this particular example, you will test
interactions with a trivial page. However, ngScenario, as the
name implies, was developed by the AngularJS team to test
AngularJS applications, so you can use karma to test single
page apps too.</p>
<p>Suppose you want to test
<a href="https://github.com/vkarpov15/karma-demo/blob/master/lib/sample.html">the following page</a>,
which uses the <code>sample.js</code> file from the previous section to
display the number &quot;42&quot; on the page.</p>
<pre><code class="language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;/sample.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
      function onLoad() {
        document.getElementById(&#39;content&#39;).innerHTML = theAnswer();
      }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body onload=&quot;onLoad()&quot;&gt;
    &lt;div id=&quot;content&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>In order to serve this page and the <code>sample.js</code> file, you need
an HTTP server. You can put together a simple one using
<a href="https://www.npmjs.com/package/express">express</a>
as show below.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();

app.use(express.static(<span class="hljs-string">'./lib'</span>));

app.listen(<span class="hljs-number">3000</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server listening on 3000'</span>);</code></pre>
<p>Navigate to <code>http://localhost:3000/sample.html</code> and you should
see the number &quot;42&quot;. Now, let&#39;s set up karma to test this.</p>
<p>In order to use ngScenario with karma, you need to install the
karma-ng-scenario plugin.</p>
<pre><code class="language-javascript">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"4.12.3"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"karma"</span>: <span class="hljs-string">"0.12.31"</span>,
    <span class="hljs-string">"karma-chrome-launcher"</span>: <span class="hljs-string">"0.1.4"</span>,
    <span class="hljs-string">"karma-ng-scenario"</span>: <span class="hljs-string">"0.1.0"</span>
  }
}</code></pre>
<p>Once you have the karma-ng-scenario plugin, you will need to
create a <a href="https://github.com/vkarpov15/karma-demo/blob/f0094a17f7fbf5b6a3941bd6066030dfbd63ab89/test/karma.ng-scenario.conf.js">slightly modified karma config file</a>.
The <code>git diff</code> between this file and the previous section&#39;s config file <code>karma.mocha.conf.js</code> is shown below.</p>
<pre><code class="language-javascript"> <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
   config.set({
     basePath: <span class="hljs-string">''</span>,

-    frameworks: [<span class="hljs-string">'mocha'</span>, <span class="hljs-string">'chai'</span>],
+    frameworks: [<span class="hljs-string">'ng-scenario'</span>],

-    files: [<span class="hljs-string">'../lib/*.js'</span>, <span class="hljs-string">'./sample.test.js'</span>],
+    files: [<span class="hljs-string">'./scenario.test.js'</span>],

     reporters: [<span class="hljs-string">'progress'</span>],

     urlRoot : <span class="hljs-string">'/__karma__/'</span>,

+    proxies : {
+      <span class="hljs-string">'/'</span>: <span class="hljs-string">'http://localhost:3000'</span>
+    },
+
     port: <span class="hljs-number">8080</span>,
     runnerPort: <span class="hljs-number">9100</span>,
     colors: <span class="hljs-literal">true</span>,

     logLevel: config.LOG_INFO,

-    autoWatch: <span class="hljs-literal">false</span>,
+    autoWatch: <span class="hljs-literal">true</span>,

     browsers: [<span class="hljs-string">'Chrome'</span>],

-    singleRun: <span class="hljs-literal">true</span>,
+    singleRun: <span class="hljs-literal">false</span>,

-    <span class="hljs-comment">// 5 sec</span>
-    browserNoActivityTimeout: <span class="hljs-number">5000</span>
+    <span class="hljs-comment">// 45 sec</span>
+    browserNoActivityTimeout: <span class="hljs-number">45000</span>
   });
 };</code></pre>
<p>That&#39;s all you need! Now, start your web server with
<code>node index.js</code> (your web server needs to be running for
ngScenario to work) and run <code>karma start</code> to execute your tests.</p>
<pre><code>$ ./node_modules/karma/bin/karma start test/karma.ng-scenario.conf.js 
WARN [proxy]: proxy &quot;http://localhost:3000&quot; normalized to &quot;http://localhost:3000/&quot;
WARN [karma]: Port 8080 in use
INFO [karma]: Karma v0.12.31 server started at http://localhost:8081/__karma__/
INFO [launcher]: Starting browser Chrome
INFO [Chrome 42.0.2311 (Mac OS X 10.10.3)]: Connected on socket pyFsC9jnnhcbkTXT5y3t with id 7382597
Chrome 42.0.2311 (Mac OS X 10.10.3): Executed 1 of 1 SUCCESS (0 secs / 0.137 secChrome 42.0.2311 (Mac OS X 10.10.3): Executed 1 of 1 SUCCESS (0.152 secs / 0.137 secs)</code></pre><p>The <code>karma.ng-scenario.conf.js</code> file is configured for karma to
automatically re-run tests if any of the loaded files change.
Suppose you changed the test file <code>scenario.test.js</code> to break:</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'sample.html'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  it(<span class="hljs-string">'displays 42'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    browser().navigateTo(<span class="hljs-string">'/sample.html'</span>);
    <span class="hljs-comment">// This assertion will fail</span>
    expect(element(<span class="hljs-string">'#content'</span>).text()).toBe(<span class="hljs-string">'43'</span>);
  });
});</code></pre>
<p>Karma will automatically re-run tests and show you the following
output.</p>
<pre><code>INFO [watcher]: Changed file &quot;/Users/vkarpov/Workspace/karma-demo/test/scenario.test.js&quot;.
Chrome 42.0.2311 (Mac OS X 10.10.3) sample.html displays 42 FAILED
  expect element &#39;#content&#39; text toBe &quot;43&quot;
  /Users/vkarpov/Workspace/karma-demo/test/scenario.test.js:4:32: expected &quot;43&quot; but was &quot;42&quot;
Chrome 42.0.2311 (Mac OS X 10.10.3): Executed 1 of 1 (1 FAILED) (0 secs / 0.121 Chrome 42.0.2311 (Mac OS X 10.10.3): Executed 1 of 1 (1 FAILED) ERROR (0.136 secs / 0.121 secs)</code></pre><p><strong>Note</strong> the AngularJS team considers <code>ngScenario</code> to be
deprecated in favor of
<a href="https://www.npmjs.com/package/protractor">protractor</a>. However,
I still think ngScenario and karma have a key niche to fill in
terms of testing JavaScript DOM interactions against a local 
server as part of TDD workflow. If you&#39;re interested in working with me to re-imagine how ngScenario should
work, shoot me an email at val [at] karpov [dot] io.</p>
<h2 id="to-the-cloud">To the Cloud!</h2>
<p>So far, you&#39;ve only tested your code in Chrome. While testing
in Chrome is better than not testing in the browser at all,
it&#39;s far from a complete testing paradigm. Thankfully, there&#39;s
<a href="https://saucelabs.com/">Sauce Labs</a>, a cloud Selenium service that
you can think of as Amazon EC2 for browsers. You can tell Sauce
to start Internet Explorer 6 running on Windows XP and give you
full control over this browser for testing purposes. In order to
get the tests in this section to work, you will have to sign up
for an account with <a href="https://saucelabs.com/">Sauce Labs</a> to get
an API key.</p>
<p>To integrate karma with Sauce, you&#39;re going to need the
karma-sauce-launcher plugin.</p>
<pre><code class="language-javascript">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"4.12.3"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"karma"</span>: <span class="hljs-string">"0.12.31"</span>,
    <span class="hljs-string">"karma-chai"</span>: <span class="hljs-string">"0.1.0"</span>,
    <span class="hljs-string">"karma-chrome-launcher"</span>: <span class="hljs-string">"0.1.4"</span>,
    <span class="hljs-string">"karma-ng-scenario"</span>: <span class="hljs-string">"0.1.0"</span>,
    <span class="hljs-string">"karma-mocha"</span>: <span class="hljs-string">"0.1.10"</span>,
    <span class="hljs-string">"karma-sauce-launcher"</span>: <span class="hljs-string">"0.2.8"</span>
  }
}</code></pre>
<p>To run the ngScenario test from the previous section on IE9 and
Safari 5 using Sauce, create
<a href="https://github.com/vkarpov15/karma-demo/blob/master/test/karma.sauce.conf.js">another karma config file</a>.
The <code>git diff</code> between this new file and the previous section&#39;s config file is show below.</p>
<pre><code class="language-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
+  <span class="hljs-keyword">var</span> customLaunchers = {
+    sl_safari: {
+      base: <span class="hljs-string">'SauceLabs'</span>,
+      browserName: <span class="hljs-string">'safari'</span>,
+      platform: <span class="hljs-string">'OS X 10.6'</span>,
+      version: <span class="hljs-string">'5'</span>
+    },
+    sl_ie_9: {
+      base: <span class="hljs-string">'SauceLabs'</span>,
+      browserName: <span class="hljs-string">'internet explorer'</span>,
+      platform: <span class="hljs-string">'Windows 7'</span>,
+      version: <span class="hljs-string">'9'</span>
+    }
+  };
+
   config.set({
     basePath: <span class="hljs-string">''</span>,

     frameworks: [<span class="hljs-string">'ng-scenario'</span>],

     files: [<span class="hljs-string">'./scenario.test.js'</span>],

-    reporters: [<span class="hljs-string">'progress'</span>],
+    reporters: [<span class="hljs-string">'saucelabs'</span>],

     urlRoot : <span class="hljs-string">'/__karma__/'</span>,

     proxies : {
       <span class="hljs-string">'/'</span>: <span class="hljs-string">'http://localhost:3000'</span>
     },

     port: <span class="hljs-number">8080</span>,
     runnerPort: <span class="hljs-number">9100</span>,
     colors: <span class="hljs-literal">true</span>,

     logLevel: config.LOG_INFO,

-    autoWatch: <span class="hljs-literal">true</span>,
+    autoWatch: <span class="hljs-literal">false</span>,
+
+    <span class="hljs-comment">// Use these custom launchers for starting browsers on Sauce</span>
+    customLaunchers: customLaunchers,

-    browsers: [<span class="hljs-string">'Chrome'</span>],
+    <span class="hljs-comment">// start these browsers</span>
+    <span class="hljs-comment">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span>
+    browsers: <span class="hljs-built_in">Object</span>.keys(customLaunchers),

-    singleRun: <span class="hljs-literal">false</span>,
+    singleRun: <span class="hljs-literal">true</span>,

     <span class="hljs-comment">// 45 sec</span>
-    browserNoActivityTimeout: <span class="hljs-number">45000</span>
+    browserNoActivityTimeout: <span class="hljs-number">45000</span>,
+
+    sauceLabs: {
+      testName: <span class="hljs-string">'Web App E2E Tests'</span>
+    },
   });
 };</code></pre>
<p>This is all you need to do. Karma handles setting up an SSH
tunnel for you, so the Sauce browser can make real requests to
your local server.</p>
<pre><code>$ env SAUCE_USERNAME=&lt;username here&gt; env SAUCE_ACCESS_KEY=&lt;API key here&gt; ./node_modules/karma/bin/karma start test/karma.sauce.conf.js 
WARN [proxy]: proxy &quot;http://localhost:3000&quot; normalized to &quot;http://localhost:3000/&quot;
WARN [karma]: Port 8080 in use
INFO [karma]: Karma v0.12.31 server started at http://localhost:8081/__karma__/
INFO [launcher]: Starting browser safari 5 (OS X 10.6) on SauceLabs
INFO [launcher]: Starting browser internet explorer 9 (Windows 7) on SauceLabs
INFO [launcher.sauce]: internet explorer 9 (Windows 7) session at https://saucelabs.com/tests/d6d4c7a5eebe493d9e98bc3559106e54
INFO [launcher.sauce]: safari 5 (OS X 10.6) session at https://saucelabs.com/tests/49dc351d56664ecb92a854b37158c1a8
INFO [IE 9.0.0 (Windows 7)]: Connected on socket vGbX2IuqZHZEP6rj9Ltx with id 56376293
INFO [Safari 5.1.9 (Mac OS X 10.6.8)]: Connected on socket K7Nfu1zw5yhVOozy9Lty with id 49486594
TOTAL: 2 SUCCESS
INFO [launcher.sauce]: Shutting down Sauce Connect</code></pre><p><strong>Note</strong> the above example does not use autowatch. This is because,
in my experience, end-to-end tests run on Sauce labs are too slow 
for the type of fast feedback I&#39;d like from the &#39;test on save&#39;
paradigm. These heavy end-to-end tests are
best run through a CI framework like
<a href="http://thecodebarbarian.com/2015/02/13/travis_coveralls">Travis</a> 
or
<a href="http://thecodebarbarian.com/2015/04/10/shippable-an-alternative-take-on-travis">Shippable</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Karma is a powerful and extensible tool for testing client-side
JS, and very much deserves its spot on the
<a href="https://www.npmjs.com/">npm home page</a>. If there&#39;s one npm module
I can&#39;t write JS without, it&#39;s karma. Karma enables you to test
standalone JavaScript or DOM integrations, locally or in the
Sauce Labs cloud. With karma, you have no excuse for half-answers
like &quot;I think so&quot; when your boss asks you if the site works in IE8.</p>
<p><em>Like this article? Chapter 9 of my upcoming book,
<a href="http://www.amazon.com/Professional-AngularJS-Valeri-Karpov/dp/1118832078/">Professional AngularJS</a>,
is a detailed guide to testing AngularJS applications. It includes
more detail about using karma and ngScenario to test AngularJS
applications, as well as protractor.</em></p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>