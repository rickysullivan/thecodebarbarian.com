<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Creating ePub Files with Node.js | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Creating ePub Files with Node.js"><meta property="og:url" content="http://www.thecodebarbarian.com/creating-epub-files-with-node-js"><meta property="og:image" content="/images/southpointe2.jpg"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="ePub is a common format for eBook readers. Here's how you can use the epub-gen npm module to create an ePub from an HTML file."><meta name="twitter:image" content="/images/southpointe2.jpg"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Creating ePub Files with Node.js</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">May 12, 2020</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CVAIKKQM&placement=carbonadsnet" id="_carbonads_js"></script><div class="post-body-text-container"><p><a href="https://en.wikipedia.org/wiki/EPUB">ePub</a> is a common format for eBooks supported
by most eBook readers other than <a href="https://www.digitaltrends.com/mobile/how-to-read-epub-books-on-your-kindle/">Amazon Kindle</a>, like <a href="https://play.google.com/books">Google Play Books</a>. The <a href="https://www.npmjs.com/package/epub-gen">epub-gen npm module</a> lets you create ePubs from HTML documents. Here&#39;s how it works.</p>
<h2 id="getting-started">Getting Started</h2>
<p>A <code>.epub</code> file is just a zip file containing a bunch of HTML, images, and metadata
about your eBook. Unfortunately, the ePub format is arcane and testing that your
ePub works correctly on all readers is difficult, so using a pre-built tool
is a good idea.</p>
<p>First, install epub-gen:</p>
<pre><code>npm install epub-gen</code></pre><p>epub-gen has 4 required parameters: <code>title</code>, <code>author</code>, an <code>output</code> path to write the epub to, and an array of <code>content</code>. Each entry in <code>content</code> corresponds to one
chapter of the book. For example, here&#39;s how you can generate an epub that contains
the first few words of <a href="https://en.wikipedia.org/wiki/Moby-Dick">Moby-Dick</a>:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> epub = <span class="hljs-built_in">require</span>(<span class="hljs-string">'epub-gen'</span>);

<span class="hljs-keyword">const</span> options = {
  title: <span class="hljs-string">'Moby-Dick'</span>,
  author: <span class="hljs-string">'Herman Melville'</span>,
  output: <span class="hljs-string">'./moby-dick.epub'</span>,
  content: [
    {
      title: <span class="hljs-string">'Chapter 1: Loomings'</span>,
      data: <span class="hljs-string">`&lt;p&gt;
        Call me Ishmael. Some years agoâ€”never mind how long precisely
      &lt;/p&gt;`</span>
    }
  ]
};

<span class="hljs-keyword">new</span> epub(options).promise.then(() =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Done'</span>));</code></pre>
<p>Here&#39;s what the above PDF looks like on the <a href="https://chrome.google.com/webstore/detail/epubreader/jhhclmfgfllimlhabjkgkeebkbiadflb?hl=en">EPUBReader Chrome extension</a>.</p>
<img src="/images/epub-1.png" class="inline-image">

<p>With some extra work, you can download the entire text version of Moby-Dick from
<a href="http://www.gutenberg.org/files/2701/2701-0.txt">Project Gutenberg</a> using <a href="https://masteringjs.io/axios">Axios</a>.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
<span class="hljs-keyword">const</span> epub = <span class="hljs-built_in">require</span>(<span class="hljs-string">'epub-gen'</span>);

axios.get(<span class="hljs-string">'http://www.gutenberg.org/files/2701/2701-0.txt'</span>).
  then(res =&gt; res.data).
  then(text =&gt; {
    text = text.slice(text.indexOf(<span class="hljs-string">'EXTRACTS.'</span>));
    text = text.slice(text.indexOf(<span class="hljs-string">'CHAPTER 1.'</span>));

    <span class="hljs-keyword">const</span> lines = text.split(<span class="hljs-string">'\r\n'</span>);
    <span class="hljs-keyword">const</span> content = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; lines.length; ++i) {
      <span class="hljs-keyword">const</span> line = lines[i];
      <span class="hljs-keyword">if</span> (line.startsWith(<span class="hljs-string">'CHAPTER '</span>)) {
        <span class="hljs-keyword">if</span> (content.length) {
          content[content.length - <span class="hljs-number">1</span>].data = content[content.length - <span class="hljs-number">1</span>].data.join(<span class="hljs-string">'\n'</span>);
        }
        content.push({
          title: line,
          data: [<span class="hljs-string">'&lt;h2&gt;'</span> + line + <span class="hljs-string">'&lt;/h2&gt;'</span>]
        });
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.trim() === <span class="hljs-string">''</span>) {
        <span class="hljs-keyword">if</span> (content[content.length - <span class="hljs-number">1</span>].data.length &gt; <span class="hljs-number">1</span>) {
          content[content.length - <span class="hljs-number">1</span>].data.push(<span class="hljs-string">'&lt;/p&gt;'</span>);
        }
        content[content.length - <span class="hljs-number">1</span>].data.push(<span class="hljs-string">'&lt;p&gt;'</span>);
      } <span class="hljs-keyword">else</span> {
        content[content.length - <span class="hljs-number">1</span>].data.push(line);
      }
    }

    <span class="hljs-keyword">const</span> options = {
      title: <span class="hljs-string">'Moby-Dick'</span>,
      author: <span class="hljs-string">'Herman Melville'</span>,
      output: <span class="hljs-string">'./moby-dick.epub'</span>,
      content
    };

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> epub(options).promise;
  }).
  then(() =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Done'</span>));</code></pre>
<h2 id="styling-and-formatting">Styling and Formatting</h2>
<p>epub-gen allows specifying custom CSS and fonts. For example, here&#39;s how you
can set <code>line-height</code> to 1.5 and use a custom font from Google fonts.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> options = {
  title: <span class="hljs-string">'Moby-Dick'</span>,
  author: <span class="hljs-string">'Herman Melville'</span>,
  output: <span class="hljs-string">'./moby-dick.epub'</span>,
  css: <span class="hljs-string">`
    * { font-family: 'PT Serif'; }
    p { line-height: 1.5em; }
  `</span>,
  <span class="hljs-comment">// You need to download the TTF file from Google Fonts</span>
  fonts: [<span class="hljs-string">'./PT_Serif/PTSerif-Regular.ttf'</span>],
  content
};</code></pre>
<p>Below is what the newly formatted eBook looks like.</p>
<img src="/images/epub-2.png" class="inline-image">

<p>You can also add a custom cover. Note that your cover must be an image, you
can&#39;t use HTML or PDF.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> options = {
  title: <span class="hljs-string">'Moby-Dick'</span>,
  author: <span class="hljs-string">'Herman Melville'</span>,
  output: <span class="hljs-string">'./moby-dick.epub'</span>,
  cover: <span class="hljs-string">'./moby-dick.jpg'</span>,
  css: <span class="hljs-string">`
    * { font-family: 'PT Serif'; }
    p { line-height: 1.5em; }
  `</span>,
  <span class="hljs-comment">// You need to download the TTF file from Google Fonts</span>
  fonts: [<span class="hljs-string">'./PT_Serif/PTSerif-Regular.ttf'</span>],
  content
};</code></pre>
<p>Here&#39;s what the epub looks like in Google Play Books with the fancy new cover:</p>
<img src="/images/epub-preview.png" class="inline-image" style="width: 50%">

<h2 id="moving-on">Moving On</h2>
<p>Along with PDF, <a href="https://en.wikipedia.org/wiki/Comparison_of_e-book_formats#Mobipocket">Mobi</a>, and <a href="https://en.wikipedia.org/wiki/Comparison_of_e-book_formats#Kindle_(Amazon)">Kindle&#39;s proprietary format</a>, ePub is one of the most popular formats for eBooks. It has the neat advantage of being more structured than PDF, and easier to style using vanilla CSS. Next time you find yourself wanting a nicely formatted version of a book for summer reading, try generating an ePub for it.</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>