<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TE4SWRGR9E"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-TE4SWRGR9E');
</script><title>We're Working on Cassandra Support for Mongoose | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="We're Working on Cassandra Support for Mongoose"><meta property="og:url" content="http://www.thecodebarbarian.com/were-working-on-cassandra-support-for-mongoose"><meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Cassandra_logo.svg/1920px-Cassandra_logo.svg.png"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="At Cassandra Forward, we previewed stargate-mongoose, a project that lets you use Mongoose with Cassandra. Here's some more info on how stargate-mongoose works and what that means for Mongoose."><meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Cassandra_logo.svg/1920px-Cassandra_logo.svg.png"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">We're Working on Cassandra Support for Mongoose</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">March 29, 2023</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYI5K3Y&placement=thecodebarbariancom" id="_carbonads_js"></script><div class="post-body-text-container"><p>At <a href="https://www.cassandrasummit.org/cassandra-forward">Cassandra Forward</a>, we introduced <a href="https://npmjs.com/package/stargate-mongoose">stargate-mongoose</a>.
Stargate-mongoose is an alternative driver for Mongoose that lets you use Mongoose with <a href="https://en.wikipedia.org/wiki/Apache_Cassandra">Cassandra</a> via DataStax&#39;s <a href="https://github.com/stargate/jsonapi">Stargate JSON API project</a>.
The news that we&#39;re working on Cassandra support for Mongoose caused a bigger stir than we anticipated; a lot of people are excited, some are concerned.
In this blog post, I&#39;ll explain what stargate-mongoose is all about and what this means for Mongoose.</p>
<h2 id="into-the-void-0-with-stargate-mongoose">Into the <code>void 0</code> with stargate-mongoose</h2>
<p>The idea is that you&#39;ll be able to plug in stargate-mongoose via <a href="https://mongoosejs.com/docs/api/mongoose.html#mongoose_Mongoose-setDriver">Mongoose&#39;s <code>setDriver()</code> function</a>, connect to Stargate, and then read to and write from Cassandra using Mongoose&#39;s existing API. 
For the most part, you&#39;ll be able to use your existing Mongoose code with <em>zero code changes</em> besides adding <code>setDriver()</code> call and changing some config options.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

mongoose.set(<span class="hljs-string">'autoCreate'</span>, <span class="hljs-literal">true</span>);
mongoose.set(<span class="hljs-string">'autoIndex'</span>, <span class="hljs-literal">false</span>);

<span class="hljs-keyword">const</span> { driver } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stargate-mongoose'</span>);
mongoose.setDriver(driver); <span class="hljs-comment">// &lt;-- Use stargate-mongoose driver</span>

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting to'</span>, process.env.STARGATE_JSON_API_URL);
<span class="hljs-keyword">await</span> mongoose.connect(process.env.STARGATE_JSON_API_URL, {
  username: process.env.STARGATE_JSON_USERNAME,
  password: process.env.STARGATE_JSON_PASSWORD,
  authUrl: process.env.STARGATE_JSON_AUTH_URL
});

<span class="hljs-comment">// Read from and write to Cassandra via Stargate</span>
<span class="hljs-keyword">const</span> TestModel = mongoose.model(
  <span class="hljs-string">'Test'</span>,
  <span class="hljs-keyword">new</span> mongoose.Schema({ answer: <span class="hljs-built_in">Number</span> })
);

<span class="hljs-comment">// Write a new document</span>
<span class="hljs-keyword">const</span> { _id } = <span class="hljs-keyword">await</span> TestModel.create({ answer: <span class="hljs-number">42</span> });
<span class="hljs-comment">// Read the document back</span>
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> TestModel.findById(_id);
doc.answer; <span class="hljs-comment">// 42</span></code></pre>
<p>Eager to try it out for yourself?
There&#39;s a <a href="https://github.com/stargate/stargate-mongoose-sample-apps">stargate-mongoose-sample-apps repo</a> that has a sample app based on <a href="https://github.com/mongoosejs/sample-apps">Mongoose&#39;s sample apps repo</a>.
The sample app is <a href="https://github.com/stargate/stargate-mongoose-sample-apps/tree/main/netlify-functions-ecommerce">netlify-functions-ecommerce</a>: an eCommerce store built on <a href="https://www.netlify.com/">Netlify</a>, including a serverless backend built with <a href="https://www.netlify.com/products/functions/">Netlify functions</a></p>
<p>For Cassandra developers, stargate-mongoose means you will have an effective bridge to the amazing capabilities of modern JavaScript.
With Mongoose and the greater JavaScript ecosystem, it will be much easier to be a <em>Full Stack Cassandra Developer</em>.
Check out the netlify-functions-ecommerce app for a taste of what&#39;s possible.
To ship that app to production, all you will need to do is sign up for a Netlify account and click a few buttons.
Netlify takes care of automatically redeploying your app on pushes to the <code>main</code> branch, SSL certificates, CDN, and API gateway for your serverless functions.</p>
<p>The Stargate JSON API is also coming to <a href="https://astra.datastax.com/">DataStax Astra</a>, DataStax&#39;s cloud Cassandra offering.
That means applications like netlify-functions-ecommerce can run fully in the cloud, so you can deploy new apps with a few clicks in a UI even without an existing Cassandra cluster.</p>
<p>While we&#39;ve made a lot of progress, Stargate and stargate-mongoose are currently not ready for production usage.
DataStax Astra also doesn&#39;t currently support the Stargate JSON API.
As of this writing, you should only run the Stargate JSON API locally for testing out the possibilities.</p>
<h2 id="what-does-this-mean-for-mongoose">What Does this Mean for Mongoose?</h2>
<p>First and foremost, I want to be as clear as possible on this point: Mongoose will continue to provide an excellent developer experience for MongoDB.
We have a great working relationship with MongoDB and plan on continuing to be a part of the MongoDB community.
As application developers, we plan on continuing to make heavy use of MongoDB in all of our apps.</p>
<p>We also have no plans to make Mongoose a multi-database ODM currently.
Stargate-mongoose is a separate project that plugs into Mongoose via Mongoose&#39;s established driver API, it is <strong>not</strong> a fork or a replica of Mongoose&#39;s API.</p>
<p>For Mongoose developers, the big news is that you&#39;ll be able to both build Mongoose apps on top of existing Cassandra deployments, and leverage Cassandra for workloads that are write and append heavy (messaging, analytics, etc.).
This should unlock new opportunities to build Mongoose applications that would not have been feasible before.</p>
<p>While Stargate is powerful and flexible, it is worth noting that you won&#39;t necessarily be able to access existing Cassandra tables via the Stargate JSON API.
The Stargate JSON API stores documents in Cassandra in a <a href="https://www.cassandrasummit.org/cassandra-forward">format called &quot;super shredding&quot;</a>.
So the Stargate JSON API won&#39;t be able to access tables that aren&#39;t in this format.</p>
<p>My hope is that MongoDB and Cassandra will be complementary tools for Mongoose developers.
Both databases have their respective merits, and have use cases that they&#39;re uniquely suited for.
Personally, as someone who develops apps using Mongoose, what I&#39;m most excited for is the opportunity to use both side-by-side.</p>
<h2 id="cross-db-populate">Cross-DB Populate</h2>
<p>I&#39;d like to leave you with an example that I find particularly interesting.
Remember how Mongoose&#39;s <a href="https://mongoosejs.com/docs/populate.html"><code>populate()</code> function</a> is an application-level join?
Well, there&#39;s nothing stopping you from using <code>populate()</code> to load documents from Cassandra, and join the results with data from MongoDB, all in one line of code.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">'mongoose'</span>;
<span class="hljs-keyword">import</span> { driver } <span class="hljs-keyword">from</span> <span class="hljs-string">'stargate-mongoose'</span>;

<span class="hljs-comment">// 1. Connect to MongoDB</span>
<span class="hljs-keyword">const</span> mongodbInstance = <span class="hljs-keyword">new</span> mongoose.Mongoose();
<span class="hljs-keyword">await</span> mongodbInstance.connect(<span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>);

<span class="hljs-comment">// 2. Connect to Stargate</span>
<span class="hljs-keyword">const</span> stargateInstance = <span class="hljs-keyword">new</span> mongoose.Mongoose();
stargateInstance.set(<span class="hljs-string">'autoCreate'</span>, <span class="hljs-literal">true</span>);
stargateInstance.set(<span class="hljs-string">'autoIndex'</span>, <span class="hljs-literal">false</span>);
stargateInstance.setDriver(driver);
<span class="hljs-keyword">await</span> stargateInstance.connect(<span class="hljs-string">'http://127.0.0.1:8080/v1/test'</span>, {
  username: <span class="hljs-string">'cassandra'</span>,
  password: <span class="hljs-string">'cassandra'</span>,
  authUrl: <span class="hljs-string">'http://127.0.0.1:8081/v1/auth'</span>
});

<span class="hljs-comment">// 3. Create a User model in MongoDB</span>
<span class="hljs-keyword">const</span> userSchema = mongoose.Schema({
  name: <span class="hljs-built_in">String</span>
});
<span class="hljs-keyword">const</span> User = mongodbInstance.model(<span class="hljs-string">'User'</span>, userSchema);

<span class="hljs-comment">// 4. Create a Message model in Cassandra with a</span>
<span class="hljs-comment">// reference to the MongoDB Model</span>
<span class="hljs-keyword">const</span> messageSchema = <span class="hljs-keyword">new</span> mongoose.Schema({
  user: { type: mongoose.Types.ObjectId, ref: User },
  text: <span class="hljs-built_in">String</span>
})
<span class="hljs-keyword">const</span> Message = stargateInstance.model(<span class="hljs-string">'Message'</span>, messageSchema);

<span class="hljs-comment">// 5. Create a user and some messages:</span>
<span class="hljs-keyword">const</span> [user1, user2] = <span class="hljs-keyword">await</span> User.create([
  { name: <span class="hljs-string">'Alice'</span> },
  { name: <span class="hljs-string">'Bob'</span> }
]);
<span class="hljs-keyword">await</span> Message.create([
  { user: user1._id, text: <span class="hljs-string">'Hello, World!'</span> },
  { user: user2._id, text: <span class="hljs-string">'This message is stored in Cassandra'</span> }
]);

<span class="hljs-comment">// 6. Load messages from Cassandra, pull associated users from MongoDB</span>
<span class="hljs-keyword">const</span> docs = <span class="hljs-keyword">await</span> Message.find().populate(<span class="hljs-string">'user'</span>);
<span class="hljs-built_in">console</span>.log(docs); <span class="hljs-comment">// Contains message text from Cassandra and user names from MongoDB</span></code></pre>
<h2 id="moving-on">Moving On</h2>
<p>The stargate-mongoose project is a huge opportunity for both Mongoose developers and the Cassandra community.
Mongoose developers will be able to build applications on top of existing Cassandra deployments, and Cassandra developers will be able to easily leverage full stack JavaScript tools for building applications.
While stargate-mongoose is still early and not quite production ready yet, I encourage you to try out the <a href="https://github.com/stargate/stargate-mongoose-sample-apps">stargate-mongoose sample apps repo</a> and let us know what you think!</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>